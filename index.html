<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>CornWacc`s Blog</title>
	<link rel="stylesheet" href="/css/style.css">
	
      <link rel="alternate" href="/atom.xml" title="CornWacc`s Blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
		</nav>
		<h1 class="header__title"><a href="/">CornWacc`s Blog</a></h1>
		<h2 class="header__subtitle">ä¸ºä¹‹åŠªåŠ›ã€‚</h2>
	</header>

	<main>
		



	<article>
	
		<h1><a href="/2019/03/27/ThreadPool`s Study/"></a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-03-27</span><br>
		
		
	</div>

	

	
		
	

	

</article>




	<article>
	
		<h1><a href="/2019/03/26/Netty`s Study/">Netty`s Study</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-03-26</span><br>
		
		
	</div>

	

	
		<h1 id="1-Nettyæ˜¯ä»€ä¹ˆ"><a href="#1-Nettyæ˜¯ä»€ä¹ˆ" class="headerlink" title="1.Nettyæ˜¯ä»€ä¹ˆ"></a>1.Nettyæ˜¯ä»€ä¹ˆ</h1><h3 id="Nettyå°è£…äº†JDKçš„NIO-æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶-ç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚"><a href="#Nettyå°è£…äº†JDKçš„NIO-æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶-ç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚" class="headerlink" title="Nettyå°è£…äº†JDKçš„NIO,æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶,ç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚"></a>Nettyå°è£…äº†JDKçš„NIO,æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶,ç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</h3><hr>
<h1 id="2-ä¸ºä»€ä¹ˆä¸ç”¨åŸç”Ÿè‡ªå¸¦çš„NIO"><a href="#2-ä¸ºä»€ä¹ˆä¸ç”¨åŸç”Ÿè‡ªå¸¦çš„NIO" class="headerlink" title="2.ä¸ºä»€ä¹ˆä¸ç”¨åŸç”Ÿè‡ªå¸¦çš„NIO"></a>2.ä¸ºä»€ä¹ˆä¸ç”¨åŸç”Ÿè‡ªå¸¦çš„NIO</h1><pre><code>1.ä½¿ç”¨JDKè‡ªå¸¦çš„NIOéœ€è¦äº†è§£å¤ªå¤šçš„æ¦‚å¿µ,ç¼–ç¨‹å¤æ‚ã€‚

2.Nettyåº•å±‚çš„IOæ¨¡å‹éšæ„åˆ‡æ¢ã€‚

3.Nettyè‡ªå¸¦æ‹†åŒ…è§£åŒ…,å¼‚å¸¸ç›‘æµ‹

4.Nettyè§£å†³äº†å¾ˆé€—JDKåŒ…æ‹¬ç©ºè½®è¯¢çš„Bug

5.è‡ªå¸¦å„ç§åè®®æ ˆ

6.Nettyåº•å±‚å¯¹çº¿ç¨‹,selectoråšäº†å¾ˆå¤šç»†å°çš„ä¼˜åŒ–,ç²¾å¿ƒè®¾è®¡çš„reactorçº¿ç¨‹æ¨¡å‹åšåˆ°éå¸¸é«˜æ•ˆçš„å¹¶å‘å¤„ç†

7.Nettyçš„å¥å£®æ€§éå¸¸å¼ºå¤§
</code></pre><hr>
<h1 id="3-Nettyå®ç°æœåŠ¡ç«¯"><a href="#3-Nettyå®ç°æœåŠ¡ç«¯" class="headerlink" title="3.Nettyå®ç°æœåŠ¡ç«¯"></a>3.Nettyå®ç°æœåŠ¡ç«¯</h1><p><figure class="figure"><img src="https://s2.ax1x.com/2019/03/27/AalVwF.jpg" alt></figure></p>
<h2 id="3-1-å¯åŠ¨æµç¨‹"><a href="#3-1-å¯åŠ¨æµç¨‹" class="headerlink" title="3.1.å¯åŠ¨æµç¨‹"></a>3.1.å¯åŠ¨æµç¨‹</h2><pre><code>1).é¦–å…ˆåˆ›å»ºäº†ä¸¤ä¸ªNioEventLoogGroup,è¿™ä¸¤ä¸ªå¯¹è±¡å¯ä»¥çœ‹åšæ˜¯ä¼ ç»ŸIOå˜æˆæ¨¡å‹çš„ä¸¤ä¸ªçº¿ç¨‹ç»„,bossè¡¨ç¤ºç«¯å£ç›‘å¬,workerè¡¨ç¤ºå¤„ç†æ¯ä¸€æ¡è¿æ¥æ•°æ®çš„è¯»å†™çš„çº¿ç¨‹ç»„ã€‚

2).ServerBootStrap:å¼•å¯¼ç±»,è¿™ä¸ªç±»å°†å¼•å¯¼æˆ‘ä»¬è¿›è¡ŒæœåŠ¡ç«¯çš„å¯åŠ¨å·¥ä½œ

3). .groupæ˜¯ç»™å¼•å¯¼ç±»é…ç½®ä¸¤å¤§çº¿ç¨‹ç»„,è¿™æ ·å¼•å¯¼ç±»çš„çº¿ç¨‹æ¨¡å‹ä¹Ÿå°±å®šå‹äº†

4). .channel(æŒ‡å®šIOæ¨¡å‹):
    NioServerSocketChannel Nioæ¨¡å‹
    OioServerSocketChannel Bioæ¨¡å‹

5). .childHandleræ–¹æ³•:ç»™å¼•å¯¼ç±»åˆ›å»ºä¸€ä¸ªChannelInitializerç”¨äºå®šä¹‰åç»­æ¯æ¡è¿æ¥çš„æ•°æ®è¯»å†™,ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚
    ChannelInitializer:è¿™ä¸ªç±»ä¸­éœ€å®šä¹‰ä¸€ä¸ªæ³›å‹å‚æ•°,ä¸ºå®šä¹‰ä¸»é€šé“å¤„ç†å™¨,å¯¹Nioçš„è¿æ¥æŠ½è±¡ã€‚

6).æœ€åæ“ä½œæ—¶å¯ä»¥ç»‘å®šç«¯å£å·:serverBootstrap.bind(è‡ªå®šä¹‰ç«¯å£å·),æ­¤æ–¹æ³•æ˜¯å¼‚æ­¥çš„ã€‚å¯ä»¥æ‹“å±•ä¸ºç«¯å£é€’å¢ç»‘å®š

7). é™„ä¸Š(Bioå¼•å¯¼è®¾ç½®):
</code></pre><p><figure class="figure"><img src="https://s2.ax1x.com/2019/03/27/Aa1BC9.jpg" alt></figure></p>
<h2 id="3-2-æ€»ç»“-è¦å¯åŠ¨ä¸€ä¸ªNettyæœåŠ¡ç«¯å¿…é¡»è¦æŒ‡å®šä¸‰ç±»å±æ€§"><a href="#3-2-æ€»ç»“-è¦å¯åŠ¨ä¸€ä¸ªNettyæœåŠ¡ç«¯å¿…é¡»è¦æŒ‡å®šä¸‰ç±»å±æ€§" class="headerlink" title="3.2.æ€»ç»“:è¦å¯åŠ¨ä¸€ä¸ªNettyæœåŠ¡ç«¯å¿…é¡»è¦æŒ‡å®šä¸‰ç±»å±æ€§"></a>3.2.æ€»ç»“:è¦å¯åŠ¨ä¸€ä¸ªNettyæœåŠ¡ç«¯å¿…é¡»è¦æŒ‡å®šä¸‰ç±»å±æ€§</h2><pre><code>1.çº¿ç¨‹æ¨¡å‹(ç›‘å¬çº¿ç¨‹ç»„,è¯»å†™å¤„ç†é€»è¾‘çº¿ç¨‹ç»„)
2.IOæ¨¡å‹(Nio,Bio)
3.è¿ç»­è¯»å†™å¤„ç†é€»è¾‘
</code></pre><hr>
<h1 id="4-Nettyå®ç°å®¢æˆ·ç«¯"><a href="#4-Nettyå®ç°å®¢æˆ·ç«¯" class="headerlink" title="4.Nettyå®ç°å®¢æˆ·ç«¯"></a>4.Nettyå®ç°å®¢æˆ·ç«¯</h1><p><figure class="figure"><img src="https://s2.ax1x.com/2019/03/27/Aa3Rs0.jpg" alt></figure></p>
<h2 id="4-1-å¯åŠ¨æµç¨‹"><a href="#4-1-å¯åŠ¨æµç¨‹" class="headerlink" title="4.1.å¯åŠ¨æµç¨‹"></a>4.1.å¯åŠ¨æµç¨‹</h2><pre><code>1.å’ŒæœåŠ¡ç«¯å¯åŠ¨ç±»ä¼¼(å®šä¹‰çº¿ç¨‹ç»„,å®šä¹‰ioæ¨¡å‹,å®šä¹‰ioå¤„ç†æ¨¡å‹å¤„ç†é€»è¾‘)

2.Bootstrap:å®¢æˆ·ç«¯çš„å¼•å¯¼ç±»è´Ÿè´£å®¢æˆ·ç«¯ä»¥åŠè¿æ¥æœåŠ¡ç«¯

3.connectæ–¹æ³•:ç”¨äºè¿æ¥,è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°(Ip/åŸŸå,ç«¯å£å·),è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥ã€‚å¯ä»¥é€šè¿‡addListeneræ–¹æ³•ç›‘å¬è¿æ¥æ˜¯å¦æˆåŠŸã€‚
</code></pre><hr>
<h1 id="5-Nettyå®ç°åŒå‘é€šä¿¡"><a href="#5-Nettyå®ç°åŒå‘é€šä¿¡" class="headerlink" title="5.Nettyå®ç°åŒå‘é€šä¿¡"></a>5.Nettyå®ç°åŒå‘é€šä¿¡</h1><pre><code>1.ä¸Šè¿°å·²ç»è®²äº†Nettyæ€ä¹ˆå®ç°ä¸¤ä¸ªç«¯çš„å»ºç«‹,éœ€è¦å®ç°ä¸¤ç«¯é€šä¿¡åˆ™åªéœ€è¦åœ¨IOè¯»å†™é€»è¾‘(ChannelInitializer)ä¸­è¿›è¡Œç›¸å…³çš„é€»è¾‘æ“ä½œã€‚
</code></pre><h2 id="5-1-æœåŠ¡ç«¯è¯»å–å†™å…¥"><a href="#5-1-æœåŠ¡ç«¯è¯»å–å†™å…¥" class="headerlink" title="5.1 æœåŠ¡ç«¯è¯»å–å†™å…¥"></a>5.1 æœåŠ¡ç«¯è¯»å–å†™å…¥</h2><p><figure class="figure"><img src="https://s2.ax1x.com/2019/03/27/AavCZD.jpg" alt="&quot;&quot;"><figcaption class="figure__caption">&quot;&quot;</figcaption></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æœåŠ¡ç«¯è‡ªå®šä¹‰é€»è¾‘å¤„ç†å™¨</span><br><span class="line"> * 1.éœ€ç»§æ‰¿å®ç°äº†ChannelHandlerè¯¥æ¥å£çš„ç±»,æ­¤å¤„è¿ç”¨çš„æ˜¯ChannelInboundHandlerAdapter</span><br><span class="line"> *</span><br><span class="line"> * æ–¹æ³•è§£é‡Šï¼š</span><br><span class="line"> * 1.channelRead:è¯¥æ–¹æ³•æ˜¯åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®åè¢«å›è°ƒ</span><br><span class="line"> * 2.writeAndFlush:å†™å‡ºäºŒè¿›åˆ¶</span><br><span class="line"> * */</span><br><span class="line"></span><br><span class="line">public class FirstServerHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext channelHandlerContext, Object s)&#123;</span><br><span class="line">        //è¯»å–å®¢æˆ·ç«¯ä¿¡æ¯</span><br><span class="line">        System.out.println(&quot;æ¥å—åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯:&quot;+new Date()+&quot;:&quot;+s);</span><br><span class="line"></span><br><span class="line">        //å†™å‡ºæ•°æ®</span><br><span class="line">        System.out.println(new Date()+&quot;æœåŠ¡ç«¯å†™å‡ºæ•°æ®:&quot;);</span><br><span class="line">        ByteBuf byteBuf = getByteBuf(channelHandlerContext);</span><br><span class="line"></span><br><span class="line">        //æ•°æ®å†™å‡º</span><br><span class="line">        channelHandlerContext.writeAndFlush(byteBuf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ByteBuf getByteBuf(ChannelHandlerContext ctx)&#123;</span><br><span class="line">        //è·å–ByteBufæŠ½è±¡,ç”Ÿæˆä¸€ä¸ªByteBuf</span><br><span class="line">        ByteBuf byteBuf = ctx.alloc().buffer();</span><br><span class="line"></span><br><span class="line">        try&#123;</span><br><span class="line">            byte[] bytes = &quot;æ¬¢è¿è¿æ¥!&quot;.getBytes(&quot;utf-8&quot;);</span><br><span class="line">            //å¡«å……ByteBuf</span><br><span class="line">            byteBuf.writeBytes(bytes);</span><br><span class="line">        &#125;catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return byteBuf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-2-å®¢æˆ·ç«¯è¯»å–å†™å…¥"><a href="#5-2-å®¢æˆ·ç«¯è¯»å–å†™å…¥" class="headerlink" title="5.2 å®¢æˆ·ç«¯è¯»å–å†™å…¥"></a>5.2 å®¢æˆ·ç«¯è¯»å–å†™å…¥</h2><p><figure class="figure"><img src="https://s2.ax1x.com/2019/03/27/AavfTe.jpg" alt="&quot;&quot;"><figcaption class="figure__caption">&quot;&quot;</figcaption></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è‡ªå®šä¹‰å®¢æˆ·ç«¯è¯»å†™é€»è¾‘å¤„ç†å™¨</span><br><span class="line"> * */</span><br><span class="line">public class FirstClientHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è¿™ä¸ªæ–¹æ³•ä¼šåœ¨å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æˆåŠŸåè¢«è°ƒç”¨</span><br><span class="line">     * */</span><br><span class="line">    @Override</span><br><span class="line">    public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</span><br><span class="line">        System.out.println(new Date() + &quot;:å®¢æˆ·ç«¯å†™å‡ºæ•°æ®:&quot;);</span><br><span class="line"></span><br><span class="line">        //1.è·å–æ•°æ®</span><br><span class="line">        ByteBuf byteBuf = getByteBuf(ctx);</span><br><span class="line"></span><br><span class="line">        //2.å†™å‡º</span><br><span class="line">        ctx.channel().writeAndFlush(byteBuf);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="line">        ByteBuf byteBuf = (ByteBuf) msg;</span><br><span class="line">        System.out.println(&quot;è·å–åˆ°æœåŠ¡å™¨ç«¯ä¿¡æ¯:&quot;+byteBuf.toString(Charset.forName(&quot;UTF-8&quot;)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ByteBuf getByteBuf(ChannelHandlerContext ctx) throws UnsupportedEncodingException &#123;</span><br><span class="line">        //1.è·å–äºŒè¿›åˆ¶æŠ½è±¡ ByteBuf ctx.allocæ–¹æ³•æ˜¯è·å–ä¸€ä¸ªByteBufçš„å†…å­˜ç®¡ç†å™¨</span><br><span class="line">        ByteBuf byteBuf = ctx.alloc().buffer();</span><br><span class="line"></span><br><span class="line">        //2.å‡†å¤‡æ•°æ®,æŒ‡å®šå­—ç¬¦ä¸²çš„å­—ç¬¦é›†ä¸ºUTF-8</span><br><span class="line">        byte[] bytes = &quot;ä½ å¥½&quot;.getBytes(&quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">        //3.å¡«å……æ•°æ®åˆ° ByteBuf</span><br><span class="line">        byteBuf.writeBytes(bytes);</span><br><span class="line"></span><br><span class="line">        return byteBuf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6.æ€»ç»“"></a>6.æ€»ç»“</h1><pre><code>1.åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€»è¾‘å¤„ç†éƒ½æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™,é€šè¿‡ç»™é€»è¾‘å¤„ç†é“¾pipelineæ·»åŠ é€»è¾‘å¤„ç†å™¨,ç”¨äºä¾¿æºæ•°æ®çš„è¯»å†™é€»è¾‘ã€‚

2.åœ¨å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåå›è°ƒé€»è¾‘å¤„ç†å™¨çš„channelActive()æ–¹æ³•ã€‚

3.æ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®åéƒ½ä¼šè°ƒç”¨channelReadæ–¹æ³•ã€‚

4.å†™æ•°æ®éœ€è°ƒç”¨writeAndFlushæ–¹æ³•,å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯äº¤äº’çš„äºŒè¿›åˆ¶æ•°æ®è½½ä½“ä¸ºByteBuf,ByteBufé€šè¿‡è¿æ¥çš„å†…å­˜ç®¡ç†å™¨åˆ›å»º,å­—èŠ‚æ•°æ®å¡«å……åˆ°ByteBufä¹‹åæ‰èƒ½å†™åˆ°å¯¹ç«¯ã€‚
</code></pre>
	

	

</article>






	<span class="different-posts">ğŸ“• end of posts ğŸ“•</span>


	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">

</div>

	    
	      <div class="footer__element">

	<ul class="footer-links">
		<li class="footer-links__link"><a href="https://github.com/CornWacc/cornWacc.github.io">gitHub</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2019 Corn | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
